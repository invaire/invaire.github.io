<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Кроссворд «Волшебство в сердце»</title>
  <style>
    body {
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      background: #f4f4f4;
    }
    h1 {
      text-align: center;
      font-family: 'Segoe UI', sans-serif;
      color: #336;
      margin: 20px;
    }
    .crossword {
      display: grid;
      grid-template-columns: repeat(11, 2.01em);
      grid-template-rows: repeat(19, 2.01em);
      gap: 0px;
      background: #f5f5f5;
      padding: 5px;
    }
    .cell {
      width: 2.5em;
      height: 2.5em;
      background: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.1em;
      font-weight: bold;
      user-select: none;
      cursor: default;
      position: relative;
      border-color: #333;
      border-width: 1px;
      border-style: solid;
    }
    .cell.blank {
      background: #f5f5f5;
      border: none !important;
    }
    .cell.start {
      cursor: pointer;
      background: #cce5ff;
    }
    .cell.filled {
      color: #333;
    }
    @media (max-width: 600px) {
      .crossword {
        transform: scale(0.85);
      }
    }
    .number {
      position: absolute;
      top: 2px;
      left: 3px;
      font-size: 0.6em;
      color: #222;
      opacity: 0.8;
    }

    #modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      position: relative;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }
    .close {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
    }
    #user-answer {
      width: 90%;
      padding: 8px;
      margin-top: 10px;
    }
    #submit-answer {
      margin-top: 10px;
      padding: 8px 16px;
    }
  </style>
</head>
<body>

  <h1>Волшебство в сердце</h1>
  <div class="crossword" id="crossword"></div>

  <script>
    let currentWord = null;
    let modalOpen = false;

    const modal = document.createElement('div');
    modal.id = 'modal';
    modal.innerHTML = `
      <div class="modal-content">
        <span class="close">&times;</span>
        <p id="question-text"></p>
        <img id="question-image" src="" alt="" style="max-width: 100%; display: none;"/>
        <input type="text" id="user-answer" placeholder="Введите слово...">
        <button id="submit-answer">ОК</button>
      </div>
    `;
    document.body.appendChild(modal);
    const 
      modalOk = document.getElementById('submit-answer'),
      modalInput = document.getElementById('user-answer');

    const container = document.getElementById('crossword');

    const rows = 19, cols = 11;
    const words = [
      {text: 'СНЕГОВИК', q: 'Стоит во дворе с морковкой вместо носа.', row: 0, col: 1, img: 'img/snegovik.png'},
      {text: 'КАКАО', q: 'Какой волшебный шоколадный напиток пьют, чтобы согреться?', row: 1, col: 2, img: 'img/kakao.png'},
      {text: 'ЕЛКА', q: 'Как зовут новогоднее нарядное дерево?', row: 2, col: 5, img: 'img/elka.png'},
      {text: 'МЕШОК', q: 'В чём Дед Мороз носит чудо и подарки?', row: 3, col: 4, img: 'img/meshok.png'},
      {text: 'СНЕГ', q: 'Он падает с неба и тает в ладошке.', row: 4, col: 4, img: 'img/sneg.png'},
      {text: 'БАЙБАЙ', q: 'Песенка: "Метель ей пела песенку, спи, ёлочка ...', row: 5, col: 3, img: 'img/bai-bai.png'},
      {text: 'САНКИ', q: 'Что мчится с горки и делает детей счастливыми?', row: 6, col: 6, img: 'img/sanki.png'},
      {text: 'КОНФЕТЫ', q: 'Яркие и сладкие, прячутся под ёлкой.', row: 7, col: 1, img: 'img/konfeti.png'},
      {text: 'ОЛИВЬЕ', q: 'Какой салат обязательно стоит на новогоднем столе?', row: 8, col: 3, img: 'img/olive.png'},
      {text: 'СНЕГУРОЧКА', q: 'Кто помогает Деду Морозу дарить подарки?', row: 9, col: 0, img: 'img/sneguroshka.png'},
      {text: '', q: '', row: 10, col: 0},
      {text: 'СЕВЕР', q: 'Где живёт Дед Мороз?', row: 11, col: 4, img: 'img/sever.png'},
      {text: '', q: '', row: 12, col: 0},
      {text: 'САНТА', q: 'Кто летает на санях с оленями?', row: 13, col: 6, img: 'img/santa.png'},
      {text: 'ДЕТИ', q: 'Кто верит в чудо и лепит снеговика?', row: 14, col: 5, img: 'img/deti.png'},
      {text: 'ПОДАРОК', q: 'Что блестящее стоит под ёлкой?', row: 15, col: 2, img: 'img/podarok.png'},
      {text: 'ЗВЕЗДА', q: ' Что сверкает на макушке ёлки?', row: 16, col: 2, img: 'img/zvezda.png'},
      {text: 'ЗАЯЦ', q: 'Кто скачет по снегу с длинными ушами?', row: 17, col: 3, img: 'img/zayaz.png'},
      {text: 'ВЕДРО', q: 'Что стоит вместо шапки у снеговика?', row: 18, col: 5, img: 'img/vedro.png'}
    ];

    const grid = [];
    for (let r = 0; r < rows; r++) {
      grid[r] = [];
      for (let c = 0; c < cols; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell blank';
        cell.dataset.r = r;
        cell.dataset.c = c;
        container.appendChild(cell);
        grid[r][c] = cell;
      }
    }

    words.forEach((w, i) => {
      const wordLength = w.text.length;

      for (let k = 0; k < wordLength; k++) {
        const r = w.row;
        const c = w.col + k;
        const cell = grid[r][c];

        cell.classList.remove('blank');
        cell.classList.add('cell');
        cell.dataset.letter = w.text[k];
        // cell.textContent = w.text[k];
        
        if (k === 0) {
          cell.classList.add('start');
          cell.title = 'Нажмите, чтобы ответить';
          cell.dataset.index = i;
          cell.addEventListener('click', startInput);

          // ⬇️ Добавляем номер слова в ячейку
          const number = document.createElement('div');
          number.textContent = (i + 1);
          number.classList.add('number');
          cell.appendChild(number);
        }
      }
    });

    // тыкнули на цифру
    function startInput(e) {
      e.preventDefault();
      const idx = e.currentTarget.dataset.index;
      currentWord = words[idx];

      document.getElementById('question-text').textContent = currentWord.q || 'Введите слово:';
      modalInput.value = '';
      document.getElementById('submit-answer').dataset.index = idx;

      const imagePath = currentWord.img || `img/${currentWord.text.toLowerCase()}.jpg`;
      const img = document.getElementById('question-image');
      img.src = imagePath;
      img.style.display = 'block';

      document.getElementById('modal').style.display = 'flex';
      modalInput.focus();
      modalOpen = true;
    }

    // проверка ответа
    modalOk.onclick = checkAnswer;

    // Закрытие модального окна
    modal.querySelector('.close').onclick = closeModal;
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
        return;
      }
      if (e.key === 'Enter' && modalOpen) {
        checkAnswer();

        return;
      }
    });

    function checkAnswer() {
      if (!currentWord) {
        return;
      }

      const userAnswer = modalInput.value.trim().toUpperCase();
      if (userAnswer === currentWord.text) {
        fillWord(currentWord);
        closeModal();
      } else {
        alert('Неправильно, попробуйте ещё.');
        modalInput.focus();
      }
    }

    function closeModal() {
      if (!modalOpen) {
        return;
      }
      modal.style.display = 'none';
      currentWord = null;
      modalOpen = false;
    }

    // Заполняет клетки если правильно ввели
    function fillWord(w) {
      for (let k = 0; k < w.text.length; k++) {
        const r = w.row;
        const c = w.col + k;
        const cell = grid[r][c];
        
        cell.textContent = w.text[k];
        cell.classList.add('filled');
      }
    }
  </script>
</body>
</html>
