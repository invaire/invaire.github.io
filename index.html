<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Кроссворд «Волшебство в сердце»</title>
  <style>
    
    /*одна переменная — один размер клетки */
    :root{
      --cell: clamp(22px, calc((100vw - 40px) / 11), 40px);         
      --grid-line: 1px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      background-image: url('img/FON.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

   /* Контейнер кроссворда */
    .crossword{
      display: grid;
      grid-template-columns: repeat(11, var(--cell));
      grid-template-rows:    repeat(19, var(--cell));
      gap: 0;
      padding: 12px;
      margin: 0 auto;
      background-color: rgba(255,255,255,.6);
      backdrop-filter: blur(5px);
      border-radius: 10px;
      box-sizing: border-box;       /* важно */
      max-width: 100vw;             /* чтобы не вылезало за экран */
      width: calc(var(--cell) * 11 + 24px); /* 24px = паддинг 12px слева + 12px справа */
    }
    }

    /* каждая клетка — пиксель-точно, без перепадов */
    .cell{
      box-sizing: border-box;        /* рамка входит в размер клетки */
      width:  var(--cell);
      height: var(--cell);
      background: rgba(255,255,255,.9);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: calc(var(--cell) * .44);  /* масштаб цифр/букв */
      font-weight: bold;
      position: relative;
      border: 1px solid #333;
      transition: background-color 0.3s, box-shadow 0.3s;
    }

    .cell:hover {
      background-color: rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
    }

    /* пустая (скрытая) клетка — тот же размер, но линия прозрачна */
    .cell.blank{
      background: transparent;
      border: 1px solid transparent;
    }

    /* стартовая подсказка */
    .cell.start{
      background: #cce5ff;
      cursor: pointer;
    }
    .cell.filled {
      color: #333;
    }
    @media (max-width: 480px){
      h1{ font-size: 1.8rem; }
      .crossword{ padding: 8px; }
    }
    
    /* маленькие номера — без влияния на высоту клетки */
    .number{
      position: absolute;
      top: 2px;
      left: 3px;
      font-size: 0.65rem;
      line-height: 1;
      pointer-events: none;
       text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* контейнер модалки */
    #modal {
      display:none;
      position:fixed;
      inset:0;                   /* top:0; right:0; bottom:0; left:0 */
      z-index:999;
      background:rgba(0,0,0,.55);
      justify-content:center;
      align-items:center;
      padding:clamp(8px,4vw,24px); /* отступы от краёв экрана */
      box-sizing:border-box;
    }
    
    /* САМО ОКНО — адаптивная ширина/высота */
    .modal-content{
      position:relative;
      background:#fff;
      border-radius:12px;
      text-align:center;
      padding:16px;
      width:min(92vw, 520px);       /* вместо фиксированных 400px */
      max-height:min(86vh, 720px);  /* чтобы помещалось по высоте */
      overflow:auto;                /* прокрутка, если контента много */
      box-shadow:0 0 20px rgba(0,0,0,.3);
    }
    
    /* картинка внутри — вписываемся в окно */
    .modal-content img{
      width:100%;
      height:auto;
      max-height:48vh;             /* чтобы под картинкой помещалось поле и кнопка */
      object-fit:contain;
      display:block;
      border-radius:8px;
      margin:0 auto 12px;
    }

    .close {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
    }
    /* поле ввода — на всю ширину и без zoom на iOS */
    #user-answer{
      width:100%;
      box-sizing:border-box;
      font-size:16px;              /* 16px убирает авто-зум в iOS */
    }
    /* крестик чуть ближе к краю на мобильных */
    .close{ top:8px; right:10px; }

    /* на узких экранах кнопку сделать широкой */
    @media (max-width:480px){
      #submit-answer{ width:100%; padding:12px; }
    }

    /* блокируем прокрутку фона, когда модалка открыта */
    body.modal-open{ overflow:hidden; }
    #submit-answer {
      margin-top: 10px;
      padding: 8px 16px;
    }
  </style>
</head>
<body>

  <h1>Волшебство в сердце</h1>
  <div class="crossword" id="crossword"></div>

  <script>
    let currentWord = null;
    let modalOpen = false;

    const modal = document.createElement('div');
    modal.id = 'modal';
    modal.innerHTML = `
      <div class="modal-content">
        <span class="close">&times;</span>
        <p id="question-text"></p>
        <img id="question-image" src="" alt="" style="max-width: 100%; display: none;"/>
        <input type="text" id="user-answer" placeholder="Введите слово...">
        <button id="submit-answer">ОК</button>
      </div>
    `;
    document.body.appendChild(modal);
    const 
      modalOk = document.getElementById('submit-answer'),
      modalInput = document.getElementById('user-answer');

    const container = document.getElementById('crossword');

    const rows = 19, cols = 11;
    const words = [
      {text: 'СНЕГОВИК', q: '✨ Стоит во дворе с морковкой вместо носа.', row: 0, col: 1, img: 'img/snegovik.jpg'},
      {text: 'КАКАО', q: '✨ Какой волшебный шоколадный напиток пьют, чтобы согреться?', row: 1, col: 2, img: 'img/kakao.jpg'},
      {text: 'ЕЛКА', q: '✨ Как зовут новогоднее нарядное дерево?', row: 2, col: 5, img: 'img/elka.jpg'},
      {text: 'МЕШОК', q: '✨ В чём Дед Мороз носит чудо и подарки?', row: 3, col: 4, img: 'img/meshok.jpg'},
      {text: 'СНЕГ', q: '✨ Он падает с неба и тает в ладошке.', row: 4, col: 4, img: 'img/sneg.jpg'},
      {text: 'БЫЧОК', q: '✨ Идет ... качается, вздыхает на ходу', row: 5, col: 6, img: 'img/bai-bai.jpg'},
      {text: 'САНКИ', q: '✨ Что мчится с горки и делает детей счастливыми?', row: 6, col: 6, img: 'img/sanki.jpg'},
      {text: 'КОНФЕТЫ', q: '✨ Яркие и сладкие, прячутся под ёлкой.', row: 7, col: 1, img: 'img/konfeti.jpg'},
      {text: 'ОЛИВЬЕ', q: '✨ Какой салат обязательно стоит на новогоднем столе?', row: 8, col: 3, img: 'img/olive.jpg'},
      {text: 'СНЕГУРОЧКА', q: '✨ Кто помогает Деду Морозу дарить подарки?', row: 9, col: 0, img: 'img/sneguroshka.jpg'},
      {text: '', q: '', row: 10, col: 0},
      {text: 'СЕВЕР', q: '✨ Где живёт Дед Мороз?', row: 11, col: 4, img: 'img/sever.jpg'},
      {text: '', q: '', row: 12, col: 0},
      {text: 'САНТА', q: '✨ Кто летает на санях с оленями?', row: 13, col: 6, img: 'img/santa.jpg'},
      {text: 'ДЕТИ', q: '✨ Кто верит в чудо и лепит снеговика?', row: 14, col: 5, img: 'img/deti.jpg'},
      {text: 'ПОДАРОК', q: '✨ Что блестящее стоит под ёлкой?', row: 15, col: 2, img: 'img/podarok.jpg'},
      {text: 'ЗВЕЗДА', q: '✨ Что сверкает на макушке ёлки?', row: 16, col: 2, img: 'img/zvezda.jpg'},
      {text: 'ЗАЯЦ', q: '✨ Кто скачет по снегу с длинными ушами?', row: 17, col: 3, img: 'img/zayaz.jpg'},
      {text: 'ВЕДРО', q: '✨ Что стоит вместо шапки у снеговика?', row: 18, col: 5, img: 'img/vedro.jpg'}
    ];

    const grid = [];
    for (let r = 0; r < rows; r++) {
      grid[r] = [];
      for (let c = 0; c < cols; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell blank';
        cell.dataset.r = r;
        cell.dataset.c = c;
        container.appendChild(cell);
        grid[r][c] = cell;
      }
    }

    words.forEach((w, i) => {
      const wordLength = w.text.length;

      for (let k = 0; k < wordLength; k++) {
        const r = w.row;
        const c = w.col + k;
        const cell = grid[r][c];

        cell.classList.remove('blank');
        cell.classList.add('cell');
        cell.dataset.letter = w.text[k];
        // cell.textContent = w.text[k];
        
        if (k === 0) {
          cell.classList.add('start');
          cell.title = 'Нажмите, чтобы ответить';
          cell.dataset.index = i;
          cell.addEventListener('click', startInput);

          // ⬇️ Добавляем номер слова в ячейку
          const number = document.createElement('div');
          number.textContent = (i + 1);
          number.classList.add('number');
          cell.appendChild(number);
        }
      }
    });

    // тыкнули на цифру
    function startInput(e) {
      e.preventDefault();
      const idx = e.currentTarget.dataset.index;
      currentWord = words[idx];

      document.getElementById('question-text').textContent = currentWord.q || 'Введите слово:';
      modalInput.value = '';
      document.getElementById('submit-answer').dataset.index = idx;

      modal.style.display = 'flex';
      document.body.classList.add('modal-open');
      const imagePath = currentWord.img || `img/${currentWord.text.toLowerCase()}.jpg`;
      const img = document.getElementById('question-image');
      img.src = imagePath;
      img.style.display = 'block';

      document.getElementById('modal').style.display = 'flex';
      modalInput.focus();
      modalOpen = true;
    }

    // проверка ответа
    modalOk.onclick = checkAnswer;

    // Закрытие модального окна
    modal.querySelector('.close').onclick = closeModal;
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
        return;
      }
      if (e.key === 'Enter' && modalOpen) {
        checkAnswer();

        return;
      }
    });

    function checkAnswer() {
      if (!currentWord) {
        return;
      }

      const userAnswer = modalInput.value.trim().toUpperCase();
      if (userAnswer === currentWord.text) {
        fillWord(currentWord);
        closeModal();
      } else {
        alert('☃️Ого! Почти угадал, попробуйте ещё раз.');
        modalInput.focus();
      }
    }

    function closeModal() {
      if (!modalOpen) {
        return;
      }
      modal.style.display = 'none';
      document.body.classList.remove('modal-open');
      currentWord = null;
      modalOpen = false;
    }

    // Заполняет клетки если правильно ввели
    function fillWord(w) {
      for (let k = 0; k < w.text.length; k++) {
        const r = w.row;
        const c = w.col + k;
        const cell = grid[r][c];
        
        cell.textContent = w.text[k];
        cell.classList.add('filled');
      }
    }
  </script>
</body>
</html>
